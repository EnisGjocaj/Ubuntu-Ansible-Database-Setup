# =============================================================================
# PostgreSQL Configuration Template
# =============================================================================
# Generated by Ansible - Do not edit manually
# This file will be overwritten on the next Ansible run
# =============================================================================

# --- Connection Settings ----------------------------------------------------

listen_addresses = '{{ postgres_bind_address }}'
port = {{ postgres_port }}
max_connections = {{ postgres_max_connections | default(100) }}

# --- Memory Settings --------------------------------------------------------

shared_buffers = {{ postgres_shared_buffers | default('128MB') }}
effective_cache_size = {{ postgres_effective_cache_size | default('1GB') }}
maintenance_work_mem = {{ postgres_maintenance_work_mem | default('64MB') }}
work_mem = {{ postgres_work_mem | default('4MB') }}

# --- Write Ahead Logging (WAL) ----------------------------------------------

wal_buffers = {{ postgres_wal_buffers | default('16MB') }}
checkpoint_completion_target = {{ postgres_checkpoint_completion_target | default(0.7) }}

# --- Query Tuning -----------------------------------------------------------

default_statistics_target = {{ postgres_default_statistics_target | default(100) }}
random_page_cost = {{ postgres_random_page_cost | default(4.0) }}
seq_page_cost = {{ postgres_seq_page_cost | default(1.0) }}

# --- Logging Configuration --------------------------------------------------

logging_collector = {{ postgres_logging_collector | default('on') }}
log_directory = '{{ postgres_log_directory | default('pg_log') }}'
log_filename = '{{ postgres_log_filename | default('postgresql-%Y-%m-%d_%H%M%S.log') }}'
log_min_messages = {{ postgres_log_min_messages | default('warning') }}
log_min_error_statement = {{ postgres_log_min_error_statement | default('error') }}
log_connections = {{ postgres_log_connections | default('off') }}
log_disconnections = {{ postgres_log_disconnections | default('off') }}

{% if postgres_debug_mode | default(false) %}
# --- Debug Mode Settings (Development Only) ---------------------------------
log_statement = 'all'
log_min_messages = info
log_min_error_statement = info
log_connections = on
log_disconnections = on
{% endif %}

# --- Locale and Formatting --------------------------------------------------

timezone = '{{ postgres_timezone | default('UTC') }}'
datestyle = '{{ postgres_datestyle | default('iso, mdy') }}'
default_text_search_config = '{{ postgres_default_text_search_config | default('pg_catalog.english') }}'

# --- Performance and Parallelism --------------------------------------------

{% if postgres_max_worker_processes is defined %}
max_worker_processes = {{ postgres_max_worker_processes }}
{% endif %}

{% if postgres_max_parallel_workers_per_gather is defined %}
max_parallel_workers_per_gather = {{ postgres_max_parallel_workers_per_gather }}
{% endif %}

# --- Extensions and Shared Libraries ----------------------------------------

{% if postgres_shared_preload_libraries is defined %}
shared_preload_libraries = '{{ postgres_shared_preload_libraries }}'
{% endif %}

# --- Statistics Collection --------------------------------------------------

{% if postgres_track_activities is defined %}
track_activities = {{ postgres_track_activities }}
{% endif %}

{% if postgres_track_counts is defined %}
track_counts = {{ postgres_track_counts }}
{% endif %}

{% if postgres_track_io_timing is defined %}
track_io_timing = {{ postgres_track_io_timing }}
{% endif %}

{% if postgres_track_functions is defined %}
track_functions = {{ postgres_track_functions }}
{% endif %}

# --- Automatic Vacuum -------------------------------------------------------

{% if postgres_autovacuum is defined %}
autovacuum = {{ postgres_autovacuum }}
{% endif %}

{% if postgres_autovacuum_max_workers is defined %}
autovacuum_max_workers = {{ postgres_autovacuum_max_workers }}
{% endif %}

{% if postgres_autovacuum_naptime is defined %}
autovacuum_naptime = {{ postgres_autovacuum_naptime }}
{% endif %}

# --- SSL Configuration (if enabled) -----------------------------------------

{% if postgres_ssl is defined and postgres_ssl == 'on' %}
ssl = on
{% if postgres_ssl_cert_file is defined %}
ssl_cert_file = '{{ postgres_ssl_cert_file }}'
{% endif %}
{% if postgres_ssl_key_file is defined %}
ssl_key_file = '{{ postgres_ssl_key_file }}'
{% endif %}
{% endif %}

# --- Custom Settings --------------------------------------------------------

# Add any additional custom PostgreSQL settings below
# These will be preserved during configuration updates

{% if postgres_custom_settings is defined %}
{% for setting in postgres_custom_settings %}
{{ setting.name }} = {{ setting.value }}
{% endfor %}
{% endif %}

# =============================================================================
# End of PostgreSQL Configuration
# =============================================================================
